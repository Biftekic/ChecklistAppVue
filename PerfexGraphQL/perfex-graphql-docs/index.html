<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfex CRM GraphQL API Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .nav {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .nav a {
            color: #3498db;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .nav a:hover {
            background-color: #f0f0f0;
        }
        
        .section {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }
        
        h3 {
            color: #34495e;
            margin-bottom: 0.5rem;
            margin-top: 1.5rem;
        }
        
        .code-block {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }
        
        .highlight {
            background-color: #e3f2fd;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: monospace;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .alert-info {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .query-builder {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .query-builder textarea {
            width: 100%;
            min-height: 150px;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            padding: 0.5rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 0.5rem;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .response-area {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            display: none;
        }
        
        .response-area pre {
            margin: 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Perfex CRM GraphQL API Documentation</h1>
            <p class="subtitle">Complete guide to querying Perfex CRM data via GraphQL</p>
        </div>
    </header>

    <div class="container">
        <nav class="nav">
            <ul>
                <li><a href="#getting-started">Getting Started</a></li>
                <li><a href="#authentication">Authentication</a></li>
                <li><a href="#schema">Schema Reference</a></li>
                <li><a href="#queries">Example Queries</a></li>
                <li><a href="#mutations">Mutations</a></li>
                <li><a href="#custom-fields">Custom Fields</a></li>
                <li><a href="#playground">Query Playground</a></li>
            </ul>
        </nav>

        <section id="getting-started" class="section">
            <h2>Getting Started</h2>
            <p>The Perfex CRM GraphQL API provides a powerful way to query and manipulate your CRM data through a single endpoint. Unlike traditional REST APIs, GraphQL allows you to request exactly the data you need in a single query.</p>
            
            <h3>Key Features</h3>
            <ul>
                <li>Single endpoint for all queries</li>
                <li>Request only the data you need</li>
                <li>Access to both native and custom modules</li>
                <li>Strongly-typed schema</li>
                <li>Support for complex queries and relationships</li>
            </ul>

            <div class="alert alert-info">
                <strong>API Endpoint:</strong> <span class="highlight">https://uredno.com/graphql</span>
            </div>
        </section>

        <section id="authentication" class="section">
            <h2>Authentication</h2>
            <p>All API requests must include an authentication token in the request headers.</p>
            
            <h3>Required Headers</h3>
            <div class="code-block">
Content-Type: application/json
authtoken: YOUR_API_TOKEN</div>

            <div class="alert alert-warning">
                <strong>Important:</strong> The authentication header uses <span class="highlight">authtoken</span> (not "Authorization") as the header name.
            </div>

            <h3>Example cURL Request</h3>
            <div class="code-block">
curl -X POST https://uredno.com/graphql \
  -H "Content-Type: application/json" \
  -H "authtoken: YOUR_API_TOKEN" \
  -d '{"query":"{ tblprojects { id name } }"}'</div>
        </section>

        <section id="schema" class="section">
            <h2>Schema Reference</h2>
            <p>The Perfex CRM GraphQL API uses table names with the "tbl" prefix. Here are the main entities you can query:</p>

            <h3>Core Entities</h3>
            <table>
                <thead>
                    <tr>
                        <th>Entity</th>
                        <th>Table Name</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Projects</td>
                        <td><span class="highlight">tblprojects</span></td>
                        <td>Project management data</td>
                    </tr>
                    <tr>
                        <td>Tasks</td>
                        <td><span class="highlight">tbltasks</span></td>
                        <td>Task and to-do items</td>
                    </tr>
                    <tr>
                        <td>Milestones</td>
                        <td><span class="highlight">tblmilestones</span></td>
                        <td>Project milestones</td>
                    </tr>
                    <tr>
                        <td>Clients</td>
                        <td><span class="highlight">tblclients</span></td>
                        <td>Customer information</td>
                    </tr>
                    <tr>
                        <td>Staff</td>
                        <td><span class="highlight">tblstaff</span></td>
                        <td>Staff members</td>
                    </tr>
                    <tr>
                        <td>Invoices</td>
                        <td><span class="highlight">tblinvoices</span></td>
                        <td>Invoice records</td>
                    </tr>
                    <tr>
                        <td>Custom Fields</td>
                        <td><span class="highlight">tblcustomfields</span></td>
                        <td>Custom field definitions</td>
                    </tr>
                    <tr>
                        <td>Custom Field Values</td>
                        <td><span class="highlight">tblcustomfieldsvalues</span></td>
                        <td>Values for custom fields</td>
                    </tr>
                    <tr>
                        <td>Task Checklist Items</td>
                        <td><span class="highlight">tbltask_checklist_items</span></td>
                        <td>Checklist items for tasks</td>
                    </tr>
                    <tr>
                        <td>Checklist Templates</td>
                        <td><span class="highlight">tbltasks_checklist_templates</span></td>
                        <td>Reusable checklist templates</td>
                    </tr>
                </tbody>
            </table>

            <h3>Available Tables</h3>
            <p>The API provides access to over 150 tables. Some key tables include:</p>
            <ul>
                <li>tblactivity_log - Activity tracking</li>
                <li>tblannouncements - System announcements</li>
                <li>tblcontracts - Contract management</li>
                <li>tblleads - Lead management</li>
                <li>tbltickets - Support tickets</li>
                <li>tblestimates - Estimates/Quotes</li>
                <li>tblexpenses - Expense tracking</li>
                <li>And many more...</li>
            </ul>
        </section>

        <section id="queries" class="section">
            <h2>Example Queries</h2>

            <h3>Query Projects</h3>
            <div class="code-block">
{
  tblprojects {
    id
    name
    description
    status
    start_date
    deadline
    project_cost
    project_rate_per_hour
    estimated_hours
  }
}</div>

            <h3>Query Tasks</h3>
            <div class="code-block">
{
  tbltasks {
    id
    name
    description
    priority
    status
    dateadded
    startdate
    duedate
    datefinished
    rel_id
    rel_type
  }
}</div>

            <h3>Query Task Checklist Items</h3>
            <div class="code-block">
{
  tbltask_checklist_items {
    id
    taskid
    description
    finished
    finished_from
    dateadded
    addedfrom
    list_order
    assigned
  }
}</div>

            <h3>Query Checklist Templates</h3>
            <div class="code-block">
{
  tbltasks_checklist_templates {
    id
    description
  }
}</div>

            <h3>Query Milestones</h3>
            <div class="code-block">
{
  tblmilestones {
    id
    name
    description
    due_date
    project_id
    color
    milestone_order
    datecreated
  }
}</div>

            <h3>Complex Query with Multiple Entities</h3>
            <div class="code-block">
{
  projects: tblprojects {
    id
    name
    status
  }
  
  milestones: tblmilestones {
    id
    name
    project_id
    due_date
  }
  
  tasks: tbltasks {
    id
    name
    priority
    status
  }
}</div>
        </section>

        <section id="mutations" class="section">
            <h2>Mutations</h2>
            <p>The Perfex CRM GraphQL API supports mutations for creating, updating, and deleting data. All mutations follow a consistent naming pattern: <span class="highlight">add</span>, <span class="highlight">update</span>, and <span class="highlight">delete</span> followed by the table name.</p>

            <div class="alert alert-info">
                <strong>Note:</strong> All field arguments in mutations accept String type, even for numeric values.
            </div>

            <h3>Available Mutations</h3>
            <table>
                <thead>
                    <tr>
                        <th>Entity</th>
                        <th>Create</th>
                        <th>Update</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Projects</td>
                        <td><span class="highlight">addTblprojects</span></td>
                        <td><span class="highlight">updateTblprojects</span></td>
                        <td><span class="highlight">deleteTblprojects</span></td>
                    </tr>
                    <tr>
                        <td>Tasks</td>
                        <td><span class="highlight">addTbltasks</span></td>
                        <td><span class="highlight">updateTbltasks</span></td>
                        <td><span class="highlight">deleteTbltasks</span></td>
                    </tr>
                    <tr>
                        <td>Milestones</td>
                        <td><span class="highlight">addTblmilestones</span></td>
                        <td><span class="highlight">updateTblmilestones</span></td>
                        <td><span class="highlight">deleteTblmilestones</span></td>
                    </tr>
                    <tr>
                        <td>Task Checklist Items</td>
                        <td><span class="highlight">addTbltask_checklist_items</span></td>
                        <td><span class="highlight">updateTbltask_checklist_items</span></td>
                        <td><span class="highlight">deleteTbltask_checklist_items</span></td>
                    </tr>
                    <tr>
                        <td>Custom Field Values</td>
                        <td><span class="highlight">addTblcustomfieldsvalues</span></td>
                        <td><span class="highlight">updateTblcustomfieldsvalues</span></td>
                        <td><span class="highlight">deleteTblcustomfieldsvalues</span></td>
                    </tr>
                </tbody>
            </table>

            <h3>Create Project</h3>
            <div class="code-block">
mutation {
  addTblprojects(
    name: "Professional Airbnb Cleaning - 123 Main St"
    description: "Cleaning checklist template"
    status: "2"
    clientid: "28"
    addedfrom: "1"
  ) {
    id
    name
    status
  }
}</div>

            <h3>Create Task</h3>
            <div class="code-block">
mutation {
  addTbltasks(
    name: "Strip Beds and Start Laundry"
    description: "Remove all bedding and start washing"
    rel_id: "50"
    rel_type: "project"
    milestone: "88"
    status: "1"
    priority: "2"
    startdate: "2025-01-15"
  ) {
    id
    name
    milestone
  }
}</div>

            <h3>Create Milestone</h3>
            <div class="code-block">
mutation {
  addTblmilestones(
    name: "BEDROOM"
    description: "35-45 minutes"
    project_id: "50"
    due_date: "2025-01-20"
    milestone_order: "1"
  ) {
    id
    name
    project_id
  }
}</div>

            <h3>Add Checklist Item</h3>
            <div class="code-block">
mutation {
  addTbltask_checklist_items(
    taskid: "1128"
    description: "Strip all beds completely"
    list_order: "1"
    finished: "0"
  ) {
    id
    taskid
    description
  }
}</div>

            <h3>Add Custom Field Value</h3>
            <div class="code-block">
mutation {
  addTblcustomfieldsvalues(
    relid: "1128"
    fieldid: "16"
    value: "30"
    fieldto: "tasks"
  ) {
    id
    value
  }
}</div>

            <h3>Update Operations</h3>
            <p>Update mutations require the ID of the record to update, plus any fields you want to change:</p>
            <div class="code-block">
mutation {
  updateTbltasks(
    id: "1128"
    status: "5"
    datefinished: "2025-01-15 14:30:00"
  ) {
    id
    status
    datefinished
  }
}</div>

            <h3>Delete Operations</h3>
            <p>Delete mutations only require the ID of the record to delete:</p>
            <div class="code-block">
mutation {
  deleteTbltask_checklist_items(id: "33") {
    id
  }
}</div>

            <h3>Complete Import Example</h3>
            <p>Here's how to import a complete cleaning task with custom fields and checklist:</p>
            <div class="code-block">
# Step 1: Create the task
mutation CreateTask {
  addTbltasks(
    name: "Clean Master Bedroom"
    rel_id: "50"
    rel_type: "project"
    milestone: "88"
    status: "1"
    priority: "2"
  ) {
    id
  }
}

# Step 2: Add custom field values (using the returned task ID)
mutation AddTimeEstimate {
  addTblcustomfieldsvalues(
    relid: "${taskId}"
    fieldid: "16"
    value: "45"
    fieldto: "tasks"
  ) {
    id
  }
}

# Step 3: Add checklist items
mutation AddChecklistItem {
  addTbltask_checklist_items(
    taskid: "${taskId}"
    description: "Remove all bedding"
    list_order: "1"
  ) {
    id
  }
}</div>

            <div class="alert alert-warning">
                <strong>Important:</strong> The GraphQL API does not support filtering with <span class="highlight">where</span> clauses. You must fetch all data and filter client-side.
            </div>
        </section>

        <section id="custom-fields" class="section">
            <h2>Custom Fields</h2>
            <p>Perfex CRM supports custom fields for various entities. You can query custom field definitions and their values.</p>

            <h3>Get Custom Field Definitions</h3>
            <div class="code-block">
{
  tblcustomfields {
    id
    name
    fieldto
    slug
    type
    options
    show_on_table
    show_on_client_portal
    only_admin
    required
  }
}</div>

            <h3>Get Custom Field Values</h3>
            <div class="code-block">
{
  tblcustomfieldsvalues {
    id
    relid
    fieldid
    value
    fieldto
  }
}</div>

            <h3>Task-Specific Custom Fields</h3>
            <p>Based on your system, the following custom fields are available for tasks:</p>
            <table>
                <thead>
                    <tr>
                        <th>Field Name</th>
                        <th>Field ID</th>
                        <th>Type</th>
                        <th>Slug</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Time Estimate</td>
                        <td>16</td>
                        <td>number</td>
                        <td>tasks_time_estimate_for_task</td>
                    </tr>
                    <tr>
                        <td>Cleaner Task Completion Notes</td>
                        <td>18</td>
                        <td>textarea</td>
                        <td>tasks_cleaner_task_completion_notes</td>
                    </tr>
                    <tr>
                        <td>Cleaning Steps</td>
                        <td>20</td>
                        <td>textarea</td>
                        <td>tasks_cleaning_steps</td>
                    </tr>
                    <tr>
                        <td>Chemicals</td>
                        <td>21</td>
                        <td>textarea</td>
                        <td>tasks_chemicals</td>
                    </tr>
                    <tr>
                        <td>Tools</td>
                        <td>22</td>
                        <td>textarea</td>
                        <td>tasks_tools</td>
                    </tr>
                    <tr>
                        <td>Safety Notes</td>
                        <td>23</td>
                        <td>textarea</td>
                        <td>tasks_safety_notes</td>
                    </tr>
                    <tr>
                        <td>Quality Standards</td>
                        <td>24</td>
                        <td>textarea</td>
                        <td>tasks_quality_standards</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="playground" class="section">
            <h2>Query Playground</h2>
            <p>Test your GraphQL queries directly from this page.</p>
            
            <div class="query-builder">
                <h3>Query Editor</h3>
                <textarea id="queryInput" placeholder="Enter your GraphQL query here...">{
  tblprojects {
    id
    name
    status
  }
}</textarea>
                <button class="btn" onclick="executeQuery()">Execute Query</button>
                
                <div id="responseArea" class="response-area">
                    <h4>Response:</h4>
                    <pre id="responseContent"></pre>
                </div>
            </div>

            <div class="alert alert-info">
                <strong>Note:</strong> To use the playground, you need to add your API token in the script or use browser developer tools to set the authtoken header.
            </div>
        </section>
    </div>

    <script>
        async function executeQuery() {
            const query = document.getElementById('queryInput').value;
            const responseArea = document.getElementById('responseArea');
            const responseContent = document.getElementById('responseContent');
            
            // Show response area
            responseArea.style.display = 'block';
            responseContent.textContent = 'Loading...';
            
            try {
                // NOTE: Replace YOUR_API_TOKEN with actual token for testing
                const response = await fetch('https://uredno.com/graphql', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'authtoken': 'YOUR_API_TOKEN' // Replace with actual token
                    },
                    body: JSON.stringify({ query })
                });
                
                const data = await response.json();
                responseContent.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                responseContent.textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>